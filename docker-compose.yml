# Docker Compose for AWS Deployment
# Product-service only - connects to external AWS RDS MySQL
# Set DB credentials via environment variables or .env file

services:
    # Product Service (merged from inventory + catalog services)
    product-service:
        build:
            context: .
            dockerfile: Dockerfile
            args:
                MODULE_NAME: product-service
        container_name: product-service
        environment:
            SPRING_PROFILES_ACTIVE: prod
            # AWS RDS MySQL connection - set these via environment variables
            DB_HOST: ${DB_HOST}
            DB_PORT: ${DB_PORT:-3306}
            DB_NAME: ${DB_NAME:-inventory}
            DB_USERNAME: ${DB_USERNAME}
            DB_PASSWORD: ${DB_PASSWORD}
            SERVER_PORT: 8081
        ports:
            - "8081:8081"
        healthcheck:
            test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8081/actuator/health" ]
            interval: 30s
            timeout: 10s
            retries: 5
            start_period: 60s
        restart: unless-stopped

# To run with search-service, use: docker-compose -f docker-compose.yml -f docker-compose.search.yml up

# Example .env file:
# DB_HOST=your-rds-instance.xxxxx.us-east-1.rds.amazonaws.com
# DB_PORT=3306
# DB_NAME=quickcommerce
# DB_USERNAME=admin
# DB_PASSWORD=your-secure-password
